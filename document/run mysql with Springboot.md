# MySQL SpringBoot

## Goal
- To connect Spring application and MySQL Database. 
- To use Spring Data JPA to access the database. 

## Requirement
- JDK 1.8 and later
- Maven 3.2+(optional) 
- MySQL on Docker 
- SpringBoot 
- Visual Studio Code
- Java 11 

## Create Database
+ First , run MySQL instance which included master password , create database and create user :

```
docker run --name mysql -e MYSQL_USER=user -e MYSQL_ROOT_PASSWORD=password -e MYSQL_PASSWORD=password -e MYSQL_DATABASE=taxdb -p 3306:3306 -d mysql
```

+ Second,connect MySQL on Docker by using following command :

```
docker exec -it mysql mysql -uroot -p
```

+ Third, to grant all of the privileges to the user or role for taxdb : 

```
GRANT ALL PRIVILEGES ON taxdb.* TO 'user'@'%';
```
 
## Create application.properties File : 
Create a resource file called ***src/main/resources/application.properties*** , then use following code : 

```
spring.jpa.hibernate.ddl-auto=update
spring.datasource.url=jdbc:mysql://${MYSQL_HOST:localhost}:3306/db_example
spring.datasource.username=springuser
spring.datasource.password=ThePassword
spring.datasource.driver-class-name =com.mysql.jdbc.Driver
#spring.jpa.show-sql: true

```

**spring.jpa.hibernate.ddl-auto** can be none, update , create or create drop.

+ none : The default of MYSQL. No change made to database structure 

+ update : Hibernate changes the database according to the gicen entity structures. 

+ create : Creates the database every time and does not drop it on close 

+ create drop : Create the database and drops it in when SessionFactory closes. 

**Take note:** Must use create or update when begin because you do not yet have the database struture. After the first run , you can use update or none


## Create the Entity Model 

Create the entity model as the following  ***src/main/java/com/example/accessingdatamysql/User.java***. Then use following code: 

```
package com.example.accessingdatamysql;

import javax.persistence.Entity;
import javax.persistence.GeneratedValue;
import javax.persistence.GenerationType;
import javax.persistence.Id;

@Entity // This tells Hibernate to make a table out of this class
public class User {
  @Id
  @GeneratedValue(strategy=GenerationType.AUTO)
  private Integer id;

  private String name;

  private String email;

  public Integer getId() {
    return id;
  }

  public void setId(Integer id) {
    this.id = id;
  }

  public String getName() {
    return name;
  }

  public void setName(String name) {
    this.name = name;
  }

  public String getEmail() {
    return email;
  }

  public void setEmail(String email) {
    this.email = email;
  }
}
```

## Create the Repository 

Create the repository that holds user records as the following ***src/main/java/com/example/accessingdatamysql/UserRepository.java*** . Then use following code: 


```
package com.example.accessingdatamysql;

import org.springframework.data.repository.CrudRepository;

import com.example.accessingdatamysql.User;

// This will be AUTO IMPLEMENTED by Spring into a Bean called userRepository
// CRUD refers Create, Read, Update, Delete

public interface UserRepository extends CrudRepository<User, Integer> {

}
```

## Create a Controller  
 Create a controller to handle HTTP requests to your application as the following  ***src/main/java/com/example/accessingdatamysql/MainController.java*** . Then use following code : 

```
package com.example.accessingdatamysql;

import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.stereotype.Controller;
import org.springframework.web.bind.annotation.GetMapping;
import org.springframework.web.bind.annotation.PostMapping;
import org.springframework.web.bind.annotation.RequestMapping;
import org.springframework.web.bind.annotation.RequestParam;
import org.springframework.web.bind.annotation.ResponseBody;

@Controller // This means that this class is a Controller
@RequestMapping(path="/demo") // This means URL's start with /demo (after Application path)
public class MainController {
  @Autowired // This means to get the bean called userRepository
         // Which is auto-generated by Spring, we will use it to handle the data
  private UserRepository userRepository;

  @PostMapping(path="/add") // Map ONLY POST Requests
  public @ResponseBody String addNewUser (@RequestParam String name
      , @RequestParam String email) {
    // @ResponseBody means the returned String is the response, not a view name
    // @RequestParam means it is a parameter from the GET or POST request

    User n = new User();
    n.setName(name);
    n.setEmail(email);
    userRepository.save(n);
    return "Saved";
  }

  @GetMapping(path="/all")
  public @ResponseBody Iterable<User> getAllUsers() {
    // This returns a JSON or XML with the users
    return userRepository.findAll();
  }
}
```